{"version":3,"names":["React","useCallback","useEffect","useImperativeHandle","useState","View","Text","styles","BackgroundTimer","defaulProps","style","textStyle","onTimes","_seconds","onPause","onEnd","interval","hours","minute","seconds","currentSeconds","CountdownComponent","forwardRef","props","ref","initialSeconds","fontFamily","autoStart","formatTime","key","setKey","Math","random","start","pause","resume","stop","init","clear","timer","setInterval","clearInterval","font","renderTimer","text","toString","length","defaultProps"],"sources":["index.tsx"],"sourcesContent":["/* eslint-disable no-bitwise */\nimport React, {\n  useCallback,\n  useEffect,\n  useImperativeHandle,\n  useState,\n} from 'react';\nimport { View, Text } from 'react-native';\nimport { styles } from './styles';\nimport type { CountDownProps } from './model';\nimport BackgroundTimer from 'react-native-background-timer';\n\nconst defaulProps = {\n  style: {},\n  textStyle: {},\n  onTimes: (_seconds: number) => {},\n  onPause: (_seconds: number) => {},\n  onEnd: (_seconds: number) => {},\n};\n\nlet interval: any = null;\nlet hours = 0;\nlet minute = 0;\nlet seconds = 0;\nlet currentSeconds = 0;\n\nconst CountdownComponent = React.forwardRef<any, CountDownProps>(\n  (props, ref) => {\n    const {\n      initialSeconds,\n      style,\n      textStyle,\n      fontFamily,\n      autoStart = false,\n      formatTime = 'hh:mm:ss',\n      onEnd,\n      onTimes,\n      onPause,\n    } = props;\n    const [key, setKey] = useState(Math.random());\n\n    useImperativeHandle(ref, () => {\n      return { start, pause, resume, stop };\n    });\n\n    const init = useCallback(() => {\n      if (initialSeconds) {\n        currentSeconds = initialSeconds;\n        hours = ~~(currentSeconds / 3600);\n        minute = ~~((currentSeconds % 3600) / 60);\n        seconds = ~~currentSeconds % 60;\n      }\n      clear();\n      setKey(Math.random());\n    }, [initialSeconds]);\n\n    const pause = useCallback(() => {\n      if (onPause) {\n        onPause(currentSeconds);\n      }\n      clear();\n    }, [onPause]);\n\n    const resume = () => {\n      if (!interval) {\n        timer();\n      }\n    };\n\n    const stop = () => {\n      if (onEnd) {\n        onEnd(currentSeconds);\n      }\n\n      init();\n      clear();\n    };\n\n    useEffect(() => {\n      return () => {\n        pause();\n        init();\n      };\n    }, [init, pause]);\n\n    useEffect(() => {\n      init();\n    }, [init, initialSeconds]);\n\n    const timer = useCallback(() => {\n      interval = BackgroundTimer.setInterval(() => {\n        if (currentSeconds > 0) {\n          currentSeconds = currentSeconds - 1;\n          hours = ~~(currentSeconds / 3600);\n          minute = ~~((currentSeconds % 3600) / 60);\n          seconds = ~~currentSeconds % 60;\n\n          if (onTimes) {\n            onTimes(currentSeconds);\n          }\n        }\n        if (currentSeconds <= 0) {\n          if (onEnd) {\n            onEnd(currentSeconds);\n          }\n          clear();\n        }\n        setKey(Math.random());\n      }, 1000);\n    }, [onEnd, onTimes]);\n\n    const start = useCallback(() => {\n      init();\n\n      if (!interval) {\n        timer();\n      }\n    }, [init, timer]);\n\n    useEffect(() => {\n      if (autoStart) {\n        start();\n      }\n    }, [autoStart, initialSeconds, start]);\n\n    const clear = () => {\n      if (interval) {\n        BackgroundTimer.clearInterval(interval);\n        interval = null;\n      }\n    };\n\n    const font = () => {\n      if (fontFamily) {\n        return {\n          fontFamily: fontFamily,\n        };\n      } else {\n        return {};\n      }\n    };\n\n    const renderTimer = () => {\n      if (formatTime === 'hh:mm:ss') {\n        if (hours > 0) {\n          return (\n            <Text style={[styles.text, textStyle, font()]}>{`${hours}:${\n              minute.toString().length === 1 ? '0' : ''\n            }${minute}:${\n              seconds.toString().length === 1 ? '0' : ''\n            }${seconds}`}</Text>\n          );\n        } else {\n          if (minute > 0) {\n            return (\n              <Text style={[styles.text, textStyle, font()]}>{`${minute}:${\n                seconds.toString().length === 1 ? '0' : ''\n              }${seconds}`}</Text>\n            );\n          } else {\n            return (\n              <Text\n                style={[styles.text, textStyle, font()]}\n              >{`${seconds}`}</Text>\n            );\n          }\n        }\n      } else {\n        return (\n          <Text\n            style={[styles.text, textStyle, font()]}\n          >{`${currentSeconds}`}</Text>\n        );\n      }\n    };\n\n    return (\n      <View style={style} key={key}>\n        {renderTimer()}\n      </View>\n    );\n  }\n);\n\nCountdownComponent.defaultProps = defaulProps;\n\nexport default CountdownComponent;\n"],"mappings":"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"}